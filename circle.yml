machine:
  services:
    - docker
dependencies:
  post:
    - envsubst < .dockercfg.template > ~/.dockercfg
test:
  override:
    - docker build --tag="${DOCKER_REGISTRY_DOMAIN}/${CIRCLE_USERNAME}/${CIRCLE_PROJECT_REPONAME}:${CIRCLE_SHA1}" .
deployment:
  release:
    branch: master
    commands:
      - docker push ${DOCKER_REGISTRY_DOMAIN}/${CIRCLE_USERNAME}/${CIRCLE_PROJECT_REPONAME}:${CIRCLE_SHA1}
